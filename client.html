<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-time Candlestick Chart</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.2/socket.io.js" integrity="sha384-5/mPahN9udY8WC5+QS8+hyEwqO9Asi4Jq79q2KQSYXcubRekn6OrcH9xnyuROOdW" crossorigin="anonymous"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
<!--    <h1>Real-time Candlestick Chart</h1>-->
<!--    <div id="connectionStatus"></div>-->
    <div id="candleChart"  style="width: 100%; height: 600px;"></div>
    <script>
        var socket = io('http://localhost:5000');

        socket.on('connect', function() {
            console.log('Connected to server');
<!--            document.getElementById('connectionStatus').innerText = 'Connected';-->
        });

        socket.on('disconnect', function() {
            console.log('Disconnected from server');
<!--            document.getElementById('connectionStatus').innerText = 'Disconnected';-->
        });

        function drawCandleChart(name, data) {
            // 캔들차트를 그릴 데이터 포맷
            var plotData = [{
                type: 'candlestick',
                x: data.map(item => item.date),  // X축: 날짜 데이터
                open: data.map(item => item.open),  // 시가
                high: data.map(item => item.high),  // 고가
                low: data.map(item => item.low),  // 저가
                close: data.map(item => item.close)  // 종가
            }];
            console.log('Open:', data);
<!--            console.log('Open:', plotData[0].open);-->
<!--            console.log('High:', plotData[0].high);-->
<!--            console.log('Low:', plotData[0].low);-->
<!--            console.log('Close:', plotData[0].close);-->

            // 캔들차트 레이아웃 설정
            var layout = {
                title: name,
                xaxis: {
                    title: 'Date',  // X축 제목
                    type: 'category'  // X축 타입: 날짜
                },
                yaxis: {
                    title: 'Price'  // Y축 제목
                }
            };

            Plotly.newPlot('candleChart', plotData, layout);
        }

        // 서버에서 캔들데이터 수신 시 캔들차트 그리기
        socket.on('candle_data', function(data) {
            // 캔들차트 그리기 함수 호출
            //console.log(data)
            var parsedData = JSON.parse(data);
            var name = parsedData[0]['name']
            drawCandleChart(name, parsedData.reverse());
        });
    </script>
</body>
</html>
